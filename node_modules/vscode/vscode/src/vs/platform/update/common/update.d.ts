import { ServiceIdentifier } from '../../instantiation/common/instantiation.js';
import { Event } from '../../../base/common/event.js';

interface IUpdate {
    version: string;
    productVersion: string;
    url?: string;
    hash?: string;
}
/**
 * Updates are run as a state machine:
 *
 *      Uninitialized
 *           ↓
 *          Idle
 *          ↓  ↑
 *   Checking for Updates  →  Available for Download
 *         ↓
 *     Downloading  →   Ready
 *         ↓               ↑
 *     Downloaded   →  Updating
 *
 * Available: There is an update available for download (linux).
 * Ready: Code will be updated as soon as it restarts (win32, darwin).
 * Downloaded: There is an update ready to be installed in the background (win32).
 */
declare const enum StateType {
    Uninitialized = "uninitialized",
    Idle = "idle",
    Disabled = "disabled",
    CheckingForUpdates = "checking for updates",
    AvailableForDownload = "available for download",
    Downloading = "downloading",
    Downloaded = "downloaded",
    Updating = "updating",
    Ready = "ready"
}
declare const enum UpdateType {
    Setup = 0,
    Archive = 1,
    Snap = 2
}
declare const enum DisablementReason {
    NotBuilt = 0,
    DisabledByEnvironment = 1,
    ManuallyDisabled = 2,
    MissingConfiguration = 3,
    InvalidConfiguration = 4,
    RunningAsAdmin = 5
}
type Uninitialized = {
    type: StateType.Uninitialized;
};
type Disabled = {
    type: StateType.Disabled;
    reason: DisablementReason;
};
type Idle = {
    type: StateType.Idle;
    updateType: UpdateType;
    error?: string;
};
type CheckingForUpdates = {
    type: StateType.CheckingForUpdates;
    explicit: boolean;
};
type AvailableForDownload = {
    type: StateType.AvailableForDownload;
    update: IUpdate;
};
type Downloading = {
    type: StateType.Downloading;
    update: IUpdate;
};
type Downloaded = {
    type: StateType.Downloaded;
    update: IUpdate;
};
type Updating = {
    type: StateType.Updating;
    update: IUpdate;
};
type Ready = {
    type: StateType.Ready;
    update: IUpdate;
};
type State = Uninitialized | Disabled | Idle | CheckingForUpdates | AvailableForDownload | Downloading | Downloaded | Updating | Ready;
declare const State: {
    Uninitialized: Uninitialized;
    Disabled: (reason: DisablementReason) => Disabled;
    Idle: (updateType: UpdateType, error?: string) => Idle;
    CheckingForUpdates: (explicit: boolean) => CheckingForUpdates;
    AvailableForDownload: (update: IUpdate) => AvailableForDownload;
    Downloading: (update: IUpdate) => Downloading;
    Downloaded: (update: IUpdate) => Downloaded;
    Updating: (update: IUpdate) => Updating;
    Ready: (update: IUpdate) => Ready;
};
declare const IUpdateService: ServiceIdentifier<IUpdateService>;
interface IUpdateService {
    readonly _serviceBrand: undefined;
    readonly onStateChange: Event<State>;
    readonly state: State;
    checkForUpdates(explicit: boolean): Promise<void>;
    downloadUpdate(): Promise<void>;
    applyUpdate(): Promise<void>;
    quitAndInstall(): Promise<void>;
    isLatestVersion(): Promise<boolean | undefined>;
    _applySpecificUpdate(packagePath: string): Promise<void>;
}

export { type AvailableForDownload, type CheckingForUpdates, type Disabled, DisablementReason, type Downloaded, type Downloading, type IUpdate, IUpdateService, type Idle, type Ready, State, StateType, type Uninitialized, UpdateType, type Updating };
